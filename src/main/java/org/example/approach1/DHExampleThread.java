package org.example.approach1;

import java.math.BigInteger;
import java.util.concurrent.ExecutionException;

public class DHExampleThread {
    static final int BASE = 16;

    public static void main(String[] args) throws ExecutionException, InterruptedException {

        BigInteger a = new BigInteger("030358110001200181000000000000000000000000000000000000000000000000000000000000000000000000000000130004006D00000000000000000000000000100CEF01FFFFFFFF0200823D965EDE4BAA181E38AF18BE592F15BE26B3D7DE33B7011E70B952BE33BD19BE6B3DA81E6119A57F671D661F3DA45BBF518F201B4B90DF384F925F782CADDC58302D82B60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001CE4EF01FFFFFFFF0200820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000084EF01FFFFFFFF02008203034032000120017E000000000000000000000000000000000000000000000000000000000000000000000000000000010004007D000FFFF000000000C03333333FFFFFFFBAAAAAAAAAA6AAAA95555555555555540000000000000000000000000000000000000000000000000000000000000000000000000000000000000010F4EF01FFFFFFFF02008244B05A9E56B6169E293FC2BE33C399FE3FAA03FF13BD4A1F6922A49C6C", 16);
        BigInteger b = new BigInteger("0303612D280164017F0000000000000000000000000000000000000000000000000000000000000000000000000000001E0005008B000101010101010101010101011564EF01FFFFFFFF02008279961A7E6A9D9A9E52215BDE8BA22B5E6FAE573E61B1803E81B416FE6F3B16DE7C121ABF6C949ABF5A1FDBBF642B58FF77AD405F5339981F4CC156FF87B994DD5728033A85BCA95A52285A5B40B5D8D844368278833F94B886C12BF958C654FE4B47AB7E37D2EA7E3330D89F2942963F404C137F22CE283F52D0143F4247569C3AE3EF01FFFFFFFF0200822E50E91A2852EB3A6D50EC9B2BCAEBF830CCD3785D5292186BD3D5187053ECF85CD12AF731468074B50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000EC501208CAF012090AF0120240000001EACEF01FFFFFFFF0200820303640E00012001820000000000000000000000000000000000000000000000000000000000000000000000000000001A000900670003F33FFFFFFFFFFBAAAAAAAAAA996655514544451104440100400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000EB5EF01FFFFFFFF0200826798997E56A01A9E43A11CFE30A643FE4EB4803E6FB6965E3C3BD89E5B", 16);

        Participant alice = new Participant("Alice", a, BASE);
        Participant bob = new Participant("Bob", b, BASE);

        // Candidate primes p
        System.out.println("[Generating candidate p's]");
        Thread paThread = alice.calculateCandidateP();
        Thread pbThread = bob.calculateCandidateP();
        paThread.join();
        pbThread.join();

        BigInteger pa = alice.getPx();
        BigInteger pb = bob.getPx();
        System.out.println();

        // p and g
        System.out.println("[Choosing p and g]");
        long start = System.nanoTime();
        BigInteger p = pa.compareTo(pb) > 0 ? pa : pb;
        System.out.println("[p time] " + (System.nanoTime() - start) + " ms\n");
        BigInteger g = new BigInteger("2");
        System.out.println("Chosen p:\t" + p.toString(BASE) + "\n");

        // Public keys A and B
        System.out.println("[Calculating public keys]");
        Thread AThread = alice.calculatePublicKey(g, p);
        Thread BThread = bob.calculatePublicKey(g, p);
        AThread.join();
        BThread.join();

        BigInteger A = alice.getPublicKey();
        BigInteger B = bob.getPublicKey();
        System.out.println();

        // Shared secret
        System.out.println("[Calculating the shared secret]");
        Thread ASecretThread = alice.calculateSharedSecret(B, p);
        Thread BSecretThread = bob.calculateSharedSecret(A, p);
        ASecretThread.join();
        BSecretThread.join();

        BigInteger sA = alice.getSharedSecret();
        BigInteger sB = alice.getSharedSecret();

        assert (sA.equals(sB)) : "Shared keys are not the same!";
    }
}


